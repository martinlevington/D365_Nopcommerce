# create the build instance 
# FROM microsoft/dotnet:2.2-sdk AS build
FROM mcr.microsoft.com/dotnet/core/sdk:2.2.301-alpine AS build

WORKDIR /src                                                                    
COPY ./src ./

# restore solution
RUN dotnet restore NopCommerce.sln

WORKDIR /src/Presentation/Nop.Web   

# build and publish project   
RUN dotnet build Nop.Web.csproj -c Release -o /app                                         
RUN dotnet publish Nop.Web.csproj -c Release -o /app/published

# create the runtime instance 
#FROM microsoft/dotnet:2.2-aspnetcore-runtime-alpine AS runtime 
FROM mcr.microsoft.com/dotnet/core/runtime:2.2-alpine AS runtime

# add globalization support 
RUN apk add --no-cache icu-libs
ENV DOTNET_SYSTEM_GLOBALIZATION_INVARIANT=false

WORKDIR /app        
RUN mkdir bin
RUN mkdir logs  
                                                            
COPY --from=build /app/published .
                            
#COPY ./src/Presentation/Nop.Web/App_Data/dataSettings.json ./App_Data/dataSettings.json

ENTRYPOINT ["dotnet", "Nop.Web.dll"]

# docker build -f DockerfileAWS -t nopcommerce .

# docker run -d -p 80:80 nopcommerce
# docker run  -p 80:80 nopcommerce